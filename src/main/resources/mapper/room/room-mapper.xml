<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="room">

    <insert id="insertRoom">
        insert into
            room
        values (
            #{id}, #{campId}, #{roomName}, #{roomType}, #{roomIntro}, #{roomDefaultPerson}, #{roomMaximumPerson}
        )
    </insert>

<!--    <select id="findAll" resultType="roomVo">-->
<!--        select-->
<!--            *-->
<!--        from-->
<!--            room-->
<!--        where-->
<!--            camp_id =#{campId}-->
<!--        order by-->
<!--            id-->
<!--    </select>-->

    <!-- 특정 캠핑장의 특정 객실 "1개"만 조회하는 쿼리 -->
<!--    <select id="findRoom" resultType="room">-->
<!--        select-->
<!--        *-->
<!--        from-->
<!--            room-->
<!--        where-->
<!--            id = #{id}-->
<!--        and-->
<!--            camp_id = #{campId}-->
<!--    </select>-->

    <!-- 객실 정보에 첨부사진도 추가 조인쿼리로 변경해봄.
         room 테이블과 room_attach 테이블을 조인한다.
         이슈: 쿼리는 정상 작동하는데 불러올 때 값을 set하지못함. -->
    <select id="findAll" resultMap="RoomVoMap">
        select
            r.*,
            a.id attach_id,
            a.room_id,
            a.room_attach_original_name,
            a.room_attach_renamed_name
        from
            room r left join room_attach a
            on r.id = a.room_id
    </select>
    <!-- RoomVoMap -->
    <resultMap id="RoomVoMap" type="RoomVo">
        <id column = "id" property="id"/>
        <result column="camp_id" property="campId"/>
        <result column="room_name" property="roomName"/>
        <result column="room_type" property="roomType"/>
        <result column="room_intro" property="roomIntro"/>
        <result column="room_default_person" property="roomDefaultPerson"/>
        <result column="room_maximum_person" property="roomMaximumPerson"/>
    <!--
                여러개인 경우 여러번 실행
                property:필드명
                ofTpye:속성(클래스명)
                roomAttach에 대한 속성. 테이블 컬럼 그대로 갖고옴.
             -->
        <collection property="roomAttachs" ofType="RoomAttach">
         <id column="attach_id" property="id"/>
            <result column ="room_id" property="roomId"/>
            <result column ="room_attach_original_name" property="roomAttachOriginalName"/>
            <result column ="room_attach_renamed_name" property="roomAttachRenamedName"/>
        </collection>
    </resultMap>

    <!--    -->
    <!-- 1229 특정 캠핑장 특정 객실 삭제 sql    -->
    <delete id="deleteRoom">
        delete
        from
            room
        where
            id = #{id}
        and
            camp_id = #{campId}
    </delete>



</mapper>